
// Sentry distinguishes distinct releases of the Android app by their
// versionName. In particular, when a Sentry-enabled build is performed, the
// sourcemaps for that build are uploaded to sentry.io, tagged with the build's
// versionName.
//
// If, for whatever reason, you're building a Sentry-enabled version of the app
// _not_ intended for release, it's probably best that those sourcemaps not
// collide with a versionName used by an actual release. (It's also nice to be
// able to filter out any events generated by development code.)
//
// The formatting of this affix is almost entirely arbitrary; it's intended for
// humans to read, not machines. Adjust to taste -- but please leave the
// username and date in, for the sake of other people looking at Sentry events.
String versionSuffix() {
    // use local git-config email, which is not necessarily `whoami`
    def username = ({ ->
        def proc = "git config --get user.email".execute()
        proc.waitFor()
        proc.in.text.takeWhile { it != '@'}
    })()
    if (username.isEmpty()) {
        throw new GradleException("Git user.email not configured?")
    }

    def date = new Date().format('yyyy-MM-dd')

    // Increment manually as desired. (Or replace with arbitrary text, if you
    // prefer.)
    def revision = "001"

    return "-${username}-${date}.${revision}"
}

ext {
    versionSuffix = this.&versionSuffix
}