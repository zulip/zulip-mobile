<style>
* {
  -webkit-user-select: none;
}
body {
  font-family: sans-serif;
  margin: 0;
}
body {
  font-size: 16px;
}
a {
  color: #08c;
  text-decoration: none;
}
blockquote {
  padding-left: 5px;
  margin-left: 10px;
  border-left-color: #ddd;
}
code {
  font-size: .857em;
  color: black;
  background-color: #f7f7f9;
  border-radius: 3px;
  border: 1px solid #e1e1e8;
  white-space: pre-wrap;
  padding: 0 4px;
  font-family: Monaco, Menlo, Consolas, "Courier New", monospace;
}
p {
  margin-top: 0;
  margin-bottom: 0.5em;
}
pre {
  padding: 0.5em;
  margin: 0;
  background-color: #f5f5f5;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
}
.subheader {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  margin-bottom: 0.5em;
}
.timerow {
  text-align: center;
  padding: 0.25em;
  color: #999;
  border-top: 1px solid #eee;
  border-bottom: 1px solid #eee;
}
.timestamp {
  color: silver;
  font-size: 14px;
}
.message {
  display: flex;
  word-wrap: break-word;
  margin: 0.5em;
}
.avatar {
  min-width: 32px;
  width: 32px;
  margin-right: 0.5em;
}
.avatar img {
  width: 100%;
  border-radius: 4px;
}
.content {
  flex: 1;
  max-width: calc(100% - 32px - 0.5em);
  word-wrap: break-word;
}
.username {
  font-weight: bold;
}
.user-mention {
  white-space: nowrap;
  background-color: #eee;
  border-radius: 3px;
  padding: 0 .2em;
  box-shadow: 0 0 0 1px #ccc;
}
.topic-header,
.private-header,
.stream-header {
  padding: 0.5em;
  margin: 0.5em 0;
}
.topic-header,
.stream-header {
  background: #e2e2e2;
}
.stream-header {
  padding: 0;
  display: flex;
  flex-direction: row;
}
.stream-text,
.title-text {
  padding: 0.25em;
}
.title-text {
  padding-left: 0.5em;
}
.arrow-right {
  width: 0;
  height: 0;
  border-top: 14px solid transparent;
  border-bottom: 14px solid transparent;
  border-left: 14px solid green;
}
.private-header {
  background: #444;
  color: white;
  padding: 0.25em;
}
.loading-avatar {
  width: 32px;
  height: 32px;
  border-radius: 4px;
  background: #ddd;
  margin-right: 0.5em;
}
.loading-content {
  width: 100%;
}
.loading-subheader {
  display: flex;
  justify-content: space-between;
}
.loading-content .block {
  background-color: #eee;
  border-radius: 10px;
  height: 8px;
  margin-bottom: 10px;
}
.loading-subheader .name {
  width: 120px;
  background-color: #ddd;
}
.loading-subheader .timestamp {
  width: 60px;
}
.message_inline_image {
  text-align: center;
}
.message_inline_image img {
  // width: 75px;
  // height: 100px;
  max-width: 50vw;
  max-height: 50vh;
}
.emoji {
  height: 25px;
  width: 25px;
  vertical-align: text-bottom;
}
blockquote {
  margin: 0.5em 0;
  border-left: 5px solid #ddd;
}
ul {
  padding-left: 1em;
  margin: 0.5em 0;
}
.codehilite .gi { color: #00a000; }
.codehilite .gd { color: #a00000; }
.codehilite .k { color: #008000; font-weight: bold; }
.codehilite .nf { color: #00f; }
.codehilite .s2 { color: #ba2121; }
.twitter-tweet {

}
.twitter-avatar {
  float: left;
  width: 32px;
  height: 32px;
  margin-right: .75em;
}
</style>

<div class="message">
    <div class="loading-avatar"></div>
    <div class="loading-content">
      <div class="loading-subheader">
        <div class="block name"></div>
        <div class="block timestamp"></div>
      </div>
      <div class="block"></div>
      <div class="block"></div>
    </div>
  </div>

  <div class="message">
    <div class="loading-avatar"></div>
    <div class="loading-content">
      <div class="loading-subheader">
        <div class="block name"></div>
        <div class="block timestamp"></div>
      </div>
      <div class="block"></div>
      <div class="block"></div>
    </div>
  </div>

  <div class="message">
    <div class="loading-avatar"></div>
    <div class="loading-content">
      <div class="loading-subheader">
        <div class="block name"></div>
        <div class="block timestamp"></div>
      </div>
      <div class="block"></div>
      <div class="block"></div>
    </div>
  </div>

  <div class="message">
    <div class="loading-avatar"></div>
    <div class="loading-content">
      <div class="loading-subheader">
        <div class="block name"></div>
        <div class="block timestamp"></div>
      </div>
      <div class="block"></div>
      <div class="block"></div>
    </div>
  </div>

  <div class="message">
    <div class="loading-avatar"></div>
    <div class="loading-content">
      <div class="loading-subheader">
        <div class="block name"></div>
        <div class="block timestamp"></div>
      </div>
      <div class="block"></div>
      <div class="block"></div>
    </div>
  </div>

  <div class="message">
    <div class="loading-avatar"></div>
    <div class="loading-content">
      <div class="loading-subheader">
        <div class="block name"></div>
        <div class="block timestamp"></div>
      </div>
      <div class="block"></div>
      <div class="block"></div>
    </div>
  </div>

MessageListWeb.js:18 MESSAGE INC Object {o: "new stuff"}
MessageListWeb.js:47
  <div class="timerow">
    <div class="timerow-left"></div>
    Today
    <div class="timerow-right"></div>
  </div>

      <div class="stream-header">
        <div class="stream-text header" style="background: #ccc"
          data-narrow="[{'operator':'stream','operand':'general'}]">
          general
        </div>
        <div class="arrow-right" style="border-left-color: #ccc"></div>
        <div class="title-text header" data-narrow="[{'operator':'stream','operand':'general'},{'operator':'topic','operand':'notification bot'}]">
          notification bot
        </div>
      </div>

  <div class="message">
    <div class="avatar">
      <img src="https://chat.zulip.org/user_avatars/8d11b13e88ff8324da17be1dced2ebf770638054.png?x=x" class="avatar-img" data-email="tabbott@zulipchat.com">
    </div>
    <div class="content">
      <div class="subheader">
        <div class="username">
          Tim Abbott
        </div>
        <div class="timestamp">
          12:35 AM
        </div>
      </div>
      <p>Since that's how we'd do it if it were important</p>
    </div>
  </div>

  <div class="message">
    <div class="avatar"><img></div>
    <div class="content">
      <p>A cheap cacheable DB query on a relatively rare codepath isn't important</p>
    </div>
  </div>

      <div class="stream-header">
        <div class="stream-text header" style="background: #ccc"
          data-narrow="[{'operator':'stream','operand':'announce'}]">
          announce
        </div>
        <div class="arrow-right" style="border-left-color: #ccc"></div>
        <div class="title-text header" data-narrow="[{'operator':'stream','operand':'announce'},{'operator':'topic','operand':'this server'}]">
          this server
        </div>
      </div>

  <div class="message">
    <div class="avatar">
      <img src="https://chat.zulip.org/user_avatars/8d11b13e88ff8324da17be1dced2ebf770638054.png?x=x" class="avatar-img" data-email="tabbott@zulipchat.com">
    </div>
    <div class="content">
      <div class="subheader">
        <div class="username">
          Tim Abbott
        </div>
        <div class="timestamp">
          12:38 AM
        </div>
      </div>
      <p>Attempting an upgrade from master + <span class="user-mention" data-user-email="hkmp7tommy@gmail.com">@Tommy Ip</span>'s new minification PR</p>
    </div>
  </div>

      <div class="stream-header">
        <div class="stream-text header" style="background: #ccc"
          data-narrow="[{'operator':'stream','operand':'general'}]">
          general
        </div>
        <div class="arrow-right" style="border-left-color: #ccc"></div>
        <div class="title-text header" data-narrow="[{'operator':'stream','operand':'general'},{'operator':'topic','operand':'notification bot'}]">
          notification bot
        </div>
      </div>

  <div class="message">
    <div class="avatar">
      <img src="https://secure.gravatar.com/avatar/b60683e6dacd4556ae15430a7c9b6f13?d=identicon" class="avatar-img" data-email="showell30@yahoo.com">
    </div>
    <div class="content">
      <div class="subheader">
        <div class="username">
          Steve Howell
        </div>
        <div class="timestamp">
          12:40 AM
        </div>
      </div>
      <p>I may be overreacting, but this change is starting to make me feel a bit queasy.  It seems like the root problem here is that we need to have notification bots just be in the same realm of the user.   Here is another route to take this:</p>
<ul>
<li>disable stream links for realms that don't have their own notification bot</li>
<li>start building out the ability for realms to have their own notification bot</li>
</ul>
<p>How hard is the latter?</p>
    </div>
  </div>

      <div class="stream-header">
        <div class="stream-text header" style="background: #ccc"
          data-narrow="[{'operator':'stream','operand':'announce'}]">
          announce
        </div>
        <div class="arrow-right" style="border-left-color: #ccc"></div>
        <div class="title-text header" data-narrow="[{'operator':'stream','operand':'announce'},{'operator':'topic','operand':'this server'}]">
          this server
        </div>
      </div>

  <div class="message">
    <div class="avatar">
      <img src="https://chat.zulip.org/user_avatars/8d11b13e88ff8324da17be1dced2ebf770638054.png?x=x" class="avatar-img" data-email="tabbott@zulipchat.com">
    </div>
    <div class="content">
      <div class="subheader">
        <div class="username">
          Tim Abbott
        </div>
        <div class="timestamp">
          12:42 AM
        </div>
      </div>
      <p>Seems to work!</p>
    </div>
  </div>

      <div class="stream-header">
        <div class="stream-text header" style="background: #ccc"
          data-narrow="[{'operator':'stream','operand':'general'}]">
          general
        </div>
        <div class="arrow-right" style="border-left-color: #ccc"></div>
        <div class="title-text header" data-narrow="[{'operator':'stream','operand':'general'},{'operator':'topic','operand':'notification bot'}]">
          notification bot
        </div>
      </div>

  <div class="message">
    <div class="avatar">
      <img src="https://secure.gravatar.com/avatar/03d6176149e9fe81c83590dd4e7a5225?d=identicon" class="avatar-img" data-email="sampdingo@hotmail.com">
    </div>
    <div class="content">
      <div class="subheader">
        <div class="username">
          Sampriti Panda
        </div>
        <div class="timestamp">
          12:43 AM
        </div>
      </div>
      <p>I guess one problem with the second is email address has to be unique.</p>
    </div>
  </div>

  <div class="message">
    <div class="avatar"><img></div>
    <div class="content">
      <p>so you can't have multiple users with same email address</p>
    </div>
  </div>

  <div class="message">
    <div class="avatar">
      <img src="https://chat.zulip.org/user_avatars/8d11b13e88ff8324da17be1dced2ebf770638054.png?x=x" class="avatar-img" data-email="tabbott@zulipchat.com">
    </div>
    <div class="content">
      <div class="subheader">
        <div class="username">
          Tim Abbott
        </div>
        <div class="timestamp">
          12:43 AM
        </div>
      </div>
      <p>Email mirror bot has the same problem</p>
    </div>
  </div>

  <div class="message">
    <div class="avatar"><img></div>
    <div class="content">
      <p>And a few others</p>
    </div>
  </div>

  <div class="message">
    <div class="avatar">
      <img src="https://secure.gravatar.com/avatar/03d6176149e9fe81c83590dd4e7a5225?d=identicon" class="avatar-img" data-email="sampdingo@hotmail.com">
    </div>
    <div class="content">
      <div class="subheader">
        <div class="username">
          Sampriti Panda
        </div>
        <div class="timestamp">
          12:43 AM
        </div>
      </div>
      <p>although the email could very well be <code>notification-bot-&lt;realm_name&gt;</code></p>
    </div>
  </div>

  <div class="message">
    <div class="avatar"><img></div>
    <div class="content">
      <p>I think the problem is mainly with Notification Bot, Welcome Bot and Email Mirror Bot?</p>
    </div>
  </div>

  <div class="message">
    <div class="avatar"><img></div>
    <div class="content">
      <p>The Error Bot doesn't matter too much, I'm using the sender stream there.</p>
    </div>
  </div>

  <div class="message">
    <div class="avatar"><img></div>
    <div class="content">
      <p>Those were the only bots which use the internal_* methods.</p>
    </div>
  </div>

  <div class="message">
    <div class="avatar">
      <img src="https://chat.zulip.org/user_avatars/8d11b13e88ff8324da17be1dced2ebf770638054.png?x=x" class="avatar-img" data-email="tabbott@zulipchat.com">
    </div>
    <div class="content">
      <div class="subheader">
        <div class="username">
          Tim Abbott
        </div>
        <div class="timestamp">
          12:44 AM
        </div>
      </div>
      <p>I think we should probably fix the proximal issue now, but I think I agree that this process is really showcasing the potential benefits of decreasing reliance on cross-realm bots for the internal bots.  </p>
    </div>
  </div>

  <div class="message">
    <div class="avatar">
      <img src="https://secure.gravatar.com/avatar/03d6176149e9fe81c83590dd4e7a5225?d=identicon" class="avatar-img" data-email="sampdingo@hotmail.com">
    </div>
    <div class="content">
      <div class="subheader">
        <div class="username">
          Sampriti Panda
        </div>
        <div class="timestamp">
          12:45 AM
        </div>
      </div>
      <p>I think this is the last issue.</p>
    </div>
  </div>

  <div class="message">
    <div class="avatar">
      <img src="https://chat.zulip.org/user_avatars/8d11b13e88ff8324da17be1dced2ebf770638054.png?x=x" class="avatar-img" data-email="tabbott@zulipchat.com">
    </div>
    <div class="content">
      <div class="subheader">
        <div class="username">
          Tim Abbott
        </div>
        <div class="timestamp">
          12:45 AM
        </div>
      </div>
      <p>Yeah I do too</p>
    </div>
  </div>

  <div class="message">
    <div class="avatar">
      <img src="https://secure.gravatar.com/avatar/03d6176149e9fe81c83590dd4e7a5225?d=identicon" class="avatar-img" data-email="sampdingo@hotmail.com">
    </div>
    <div class="content">
      <div class="subheader">
        <div class="username">
          Sampriti Panda
        </div>
        <div class="timestamp">
          12:45 AM
        </div>
      </div>
      <p>The EmbedLinks worker that is.</p>
    </div>
  </div>

      <div class="stream-header">
        <div class="stream-text header" style="background: #ccc"
          data-narrow="[{'operator':'stream','operand':'test here'}]">
          test here
        </div>
        <div class="arrow-right" style="border-left-color: #ccc"></div>
        <div class="title-text header" data-narrow="[{'operator':'stream','operand':'test here'},{'operator':'topic','operand':':heart:'}]">
          :heart:
        </div>
      </div>

  <div class="message">
    <div class="avatar">
      <img src="https://chat.zulip.org/user_avatars/ad92a0948643e6816ec2fef80288d6fd1d662928.png?x=x" class="avatar-img" data-email="cynthialin1004@gmail.com">
    </div>
    <div class="content">
      <div class="subheader">
        <div class="username">
          Cynthia Lin
        </div>
        <div class="timestamp">
          12:56 AM
        </div>
      </div>
      <p><img alt=":heart:" class="emoji" src="https://chat.zulip.org/static/generated/emoji/images/emoji/heart.png" title=":heart:"></p>
    </div>
  </div>

      <div class="stream-header">
        <div class="stream-text header" style="background: #ccc"
          data-narrow="[{'operator':'stream','operand':'general'}]">
          general
        </div>
        <div class="arrow-right" style="border-left-color: #ccc"></div>
        <div class="title-text header" data-narrow="[{'operator':'stream','operand':'general'},{'operator':'topic','operand':'notification bot'}]">
          notification bot
        </div>
      </div>

  <div class="message">
    <div class="avatar">
      <img src="https://secure.gravatar.com/avatar/03d6176149e9fe81c83590dd4e7a5225?d=identicon" class="avatar-img" data-email="sampdingo@hotmail.com">
    </div>
    <div class="content">
      <div class="subheader">
        <div class="username">
          Sampriti Panda
        </div>
        <div class="timestamp">
          12:59 AM
        </div>
      </div>
      <p>Can you point me to some piece of code where I can understand how caching is implemented?</p>
    </div>
  </div>

  <div class="message">
    <div class="avatar"><img></div>
    <div class="content">
      <p><span class="user-mention" data-user-email="tabbott@zulipchat.com">@Tim Abbott</span> ^</p>
    </div>
  </div>
